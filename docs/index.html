<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fren.ca | Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #e63946;
            --light: #f1faee;
            --accent: #a8dadc;
            --dark: #1d3557;
            --medium: #457b9d;
            --fr: #002395; /* French blue */
            --en: #FF0000; /* English red */
            --success: #4CAF50; /* Green for success messages */
            --warning: #FF9800; /* Orange for warnings */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .landing-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            display: none;
        }
        
        .dashboard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            display: none;
        }
        
        .login-box, .dashboard-box, .verification-box, .registration-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            text-align: center;
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .logo-container {
            margin-bottom: 2rem;
        }
        
        .logo {
            font-size: 3rem;
            font-weight: 700;
            text-decoration: none;
            display: flex;
            justify-content: center;
        }
        
        .logo-part {
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 4px;
            padding: 0.2rem;
        }
        
        .logo-fr {
            color: var(--fr);
        }
        
        .logo-fr:hover {
            background-color: rgba(0, 35, 149, 0.1);
        }
        
        .logo-en {
            color: var(--en);
        }
        
        .logo-en:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .logo-ca {
            color: var(--dark);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        input[type="email"],
        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
        }
        
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--medium);
            box-shadow: 0 0 0 2px rgba(69, 123, 157, 0.2);
        }
        
        .button {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 1rem;
            width: 100%;
        }
        
        .button:hover {
            background-color: #d12836;
        }
        
        .secondary-button {
            background-color: transparent;
            color: var(--medium);
            border: 1px solid var(--medium);
            margin-top: 0.5rem;
        }
        
        .secondary-button:hover {
            background-color: rgba(69, 123, 157, 0.1);
            color: var(--medium);
        }
        
        .links {
            margin-top: 1.5rem;
            font-size: 0.9rem;
        }
        
        .links a {
            color: var(--medium);
            text-decoration: none;
            cursor: pointer;
        }
        
        .links a:hover {
            text-decoration: underline;
        }
        
        .payment-methods {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .payment-methods img {
            height: 24px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .payment-methods img:hover {
            opacity: 1;
        }
        
        .divider {
            margin: 1.5rem 0;
            display: flex;
            align-items: center;
            color: #999;
        }
        
        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background-color: #ddd;
        }
        
        .divider span {
            padding: 0 1rem;
            font-size: 0.9rem;
        }
        
        .error-message {
            color: var(--primary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            text-align: center;
        }
        
        footer {
            margin-top: auto;
            text-align: center;
            padding: 1rem;
            color: var(--medium);
            font-size: 0.8rem;
            display: none;
        }
        
        /* Password strength meter */
        .password-strength-container {
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .password-strength-bar {
            height: 4px;
            background-color: #eee;
            border-radius: 2px;
            margin-bottom: 4px;
        }
        
        .strength-indicator {
            height: 100%;
            width: 0;
            border-radius: 2px;
            transition: width 0.3s, background-color 0.3s;
        }
        
        .password-feedback {
            font-size: 0.8rem;
            color: var(--medium);
        }
        
        .verification-message {
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        /* Checkbox styles */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-top: 0.3rem;
            margin-right: 0.5rem;
        }
        
        .checkbox-label {
            font-size: 0.9rem;
            display: inline;
        }

        /* Loading indicator */
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-top: 2px solid var(--medium);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            margin-top: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Landing Page with Logo Only -->
    <div class="landing-page" id="landing-page">
        <div class="logo-container">
            <div class="logo">
                <span class="logo-part logo-fr" id="fr-switch-landing">fr</span>
                <span class="logo-part logo-en" id="en-switch-landing">en</span>
                <span class="logo-ca">.ca (test)</span>
            </div>
        </div>
    </div>
    
    <!-- Login Page -->
    <div class="login-container" id="login-container">
        <div class="logo-container">
            <div class="logo">
                <span class="logo-part logo-fr" id="fr-switch">fr</span>
                <span class="logo-part logo-en" id="en-switch">en</span>
                <span class="logo-ca">.ca (test)</span>
            </div>
        </div>
        
        <!-- English Login Form -->
        <div class="login-box" id="en-login">
            <h2>Sign In</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);">Access your account</p>
            
            <form id="login-form-en">
                <div class="form-group">
                    <label for="email-en">Email</label>
                    <input type="email" id="email-en" placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label for="password-en">Password</label>
                    <input type="password" id="password-en" placeholder="••••••••">
                    <div class="password-strength-container" id="password-strength-container-en">
                        <div class="password-strength-bar">
                            <div class="strength-indicator" id="strength-indicator-en"></div>
                        </div>
                        <div class="password-feedback" id="password-feedback-en"></div>
                    </div>
                </div>
                
                <button type="submit" class="button">Sign In</button>
                <button type="button" class="button secondary-button" id="create-account-en">Create Account</button>
                <div class="error-message" id="error-en"></div>
                <div class="loading-spinner" id="loading-spinner-en"></div>
            </form>
            
            <div class="links">
                <a id="forgot-password-en">Forgot password?</a>
            </div>
        </div>
        
        <!-- French Login Form -->
        <div class="login-box" id="fr-login">
            <h2>Connexion</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);">Accédez à votre compte</p>
            
            <form id="login-form-fr">
                <div class="form-group">
                    <label for="email-fr">Courriel</label>
                    <input type="email" id="email-fr" placeholder="votre@courriel.com">
                </div>
                
                <div class="form-group">
                    <label for="password-fr">Mot de passe</label>
                    <input type="password" id="password-fr" placeholder="••••••••">
                    <div class="password-strength-container" id="password-strength-container-fr">
                        <div class="password-strength-bar">
                            <div class="strength-indicator" id="strength-indicator-fr"></div>
                        </div>
                        <div class="password-feedback" id="password-feedback-fr"></div>
                    </div>
                </div>
                
                <button type="submit" class="button">Se connecter</button>
                <button type="button" class="button secondary-button" id="create-account-fr">Créer un compte</button>
                <div class="error-message" id="error-fr"></div>
                <div class="loading-spinner" id="loading-spinner-fr"></div>
            </form>
            
            <div class="links">
                <a id="forgot-password-fr">Mot de passe oublié?</a>
            </div>
        </div>
        
        <!-- Registration Form with data-attributes -->
        <div class="registration-box" id="registration-box">
            <h2 data-i18n="registerTitle">Create Account</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);" data-i18n="registerSubtitle">Join fren.ca</p>
            
            <form id="registration-form">
                <div class="form-group">
                    <label for="reg-email" data-i18n="emailLabel">Email</label>
                    <input type="email" id="reg-email" data-i18n-placeholder="emailPlaceholder">
                </div>
                
                <div class="form-group">
                    <label for="reg-email-confirm" data-i18n="emailConfirmLabel">Confirm Email</label>
                    <input type="email" id="reg-email-confirm" data-i18n-placeholder="emailConfirmPlaceholder">
                </div>
                
                <div class="form-group">
                    <label for="reg-password" data-i18n="passwordLabel">Password</label>
                    <input type="password" id="reg-password" placeholder="••••••••">
                    <div class="password-strength-container">
                        <div class="password-strength-bar">
                            <div class="strength-indicator" id="reg-strength-indicator"></div>
                        </div>
                        <div class="password-feedback" id="reg-password-feedback"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="reg-password-confirm" data-i18n="passwordConfirmLabel">Confirm Password</label>
                    <input type="password" id="reg-password-confirm" placeholder="••••••••">
                </div>
                
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="terms-checkbox">
                    <label for="terms-checkbox" class="checkbox-label" data-i18n="termsCheckbox">
                        I agree to the <a href="terms.html" target="_blank" data-i18n="termsLink">Terms of Service</a> and 
                        <a href="privacy.html" target="_blank" data-i18n="privacyLink">Privacy Policy</a>
                    </label>
                </div>
                
                <button type="submit" class="button" data-i18n="registerButton">Create Account</button>
                <button type="button" class="button secondary-button" id="back-to-login-btn" data-i18n="backToLoginButton">Back to Login</button>
                <div class="error-message" id="reg-error"></div>
                <div class="loading-spinner" id="loading-spinner-reg"></div>
            </form>
        </div>
        
        <!-- Email Verification Forms -->
        <div class="verification-box" id="en-verification">
            <h2>Verify Your Email</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);">We've sent a verification link to your email</p>
            
            <div class="verification-message">
                <p>Please check your inbox and click the link to verify your account.</p>
                <p>Didn't receive the email?</p>
            </div>
            
            <button type="button" class="button" id="resend-verification-en">Resend Verification</button>
            <button type="button" class="button secondary-button" id="back-to-login-en">Back to Login</button>
            <div class="loading-spinner" id="loading-spinner-verify-en"></div>
        </div>
        
        <div class="verification-box" id="fr-verification">
            <h2>Vérifiez Votre Courriel</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);">Nous avons envoyé un lien de vérification</p>
            
            <div class="verification-message">
                <p>Veuillez vérifier votre boîte de réception et cliquer sur le lien pour vérifier votre compte.</p>
                <p>Vous n'avez pas reçu le courriel?</p>
            </div>
            
            <button type="button" class="button" id="resend-verification-fr">Renvoyer le courriel</button>
            <button type="button" class="button secondary-button" id="back-to-login-fr">Retour à la connexion</button>
            <div class="loading-spinner" id="loading-spinner-verify-fr"></div>
        </div>
    </div>
    
    <!-- Dashboard Page -->
    <div class="dashboard-container" id="dashboard-container">
        <div class="logo-container">
            <div class="logo">
                <span class="logo-part logo-fr" id="fr-switch-dashboard">fr</span>
                <span class="logo-part logo-en" id="en-switch-dashboard">en</span>
                <span class="logo-ca">.ca (test)</span>
            </div>
        </div>
        
        <!-- English Dashboard -->
        <div class="dashboard-box" id="en-dashboard">
            <h2>Welcome!</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);" id="welcome-email-en">Logged in as: </p>
            <button type="button" class="button" id="logout-en">Sign Out</button>
        </div>
        
        <!-- French Dashboard -->
        <div class="dashboard-box" id="fr-dashboard">
            <h2>Bienvenue!</h2>
            <p style="margin-bottom: 1.5rem; color: var(--medium);" id="welcome-email-fr">Connecté en tant que: </p>
            <button type="button" class="button" id="logout-fr">Se déconnecter</button>
        </div>
    </div>
    
    <footer id="footer-en">
        &copy; 2025 fren.ca. All rights reserved.
    </footer>
    
    <footer id="footer-fr">
        &copy; 2025 fren.ca. Tous droits réservés.
    </footer>
    
    <!-- Firebase Configuration -->
    <script type="module">
        // === FIREBASE INITIALIZATION ===
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBmIh93J8Mub45ifggCud3VzfYgQMtVIXU",
            authDomain: "frenca-test-database.firebaseapp.com",
            projectId: "frenca-test-database",
            storageBucket: "frenca-test-database.firebasestorage.app",
            messagingSenderId: "541348424936",
            appId: "1:541348424936:web:8467a8a05587f009552d5d",
            measurementId: "G-L9Y9KTSB8T"
        };
        
        console.log('Script starting...');
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        console.log('Firebase initialized');
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        console.log('Auth initialized');
        
        // === TRANSLATIONS ===
        // Translation object for the data-attribute system
        const translations = {
            en: {
                registerTitle: "Create Account",
                registerSubtitle: "Join fren.ca",
                emailLabel: "Email",
                emailPlaceholder: "your@email.com",
                emailConfirmLabel: "Confirm Email",
                emailConfirmPlaceholder: "your@email.com",
                passwordLabel: "Password",
                passwordConfirmLabel: "Confirm Password",
                termsCheckbox: "I agree to the Terms of Service and Privacy Policy",
                termsLink: "Terms of Service",
                privacyLink: "Privacy Policy",
                registerButton: "Create Account",
                backToLoginButton: "Back to Login",
                passwordStrength: "Strong password",
                passwordRequirements: "Password should have:",
                passwordLength: "8+ characters.",
                passwordNumber: "At least 1 number.",
                passwordUpper: "At least 1 uppercase letter.",
                passwordSpecial: "At least 1 special character.",
                errorEmailRequired: "Please enter your email address",
                errorEmailMatch: "Email addresses do not match",
                errorPasswordRequired: "Please enter your password",
                errorPasswordMatch: "Passwords do not match",
                errorTermsRequired: "You must accept the Terms of Service and Privacy Policy",
                successAccountCreated: "Account created! Please check your email to verify your address."
            },
            fr: {
                registerTitle: "Créer un compte",
                registerSubtitle: "Rejoindre fren.ca",
                emailLabel: "Courriel",
                emailPlaceholder: "votre@courriel.com",
                emailConfirmLabel: "Confirmer le courriel",
                emailConfirmPlaceholder: "votre@courriel.com",
                passwordLabel: "Mot de passe",
                passwordConfirmLabel: "Confirmer le mot de passe",
                termsCheckbox: "J'accepte les Conditions d'utilisation et la Politique de confidentialité",
                termsLink: "Conditions d'utilisation",
                privacyLink: "Politique de confidentialité",
                registerButton: "Créer un compte",
                backToLoginButton: "Retour à la connexion",
                passwordStrength: "Mot de passe fort",
                passwordRequirements: "Le mot de passe doit avoir:",
                passwordLength: "8+ caractères.",
                passwordNumber: "Au moins 1 chiffre.",
                passwordUpper: "Au moins 1 majuscule.",
                passwordSpecial: "Au moins 1 caractère spécial.",
                errorEmailRequired: "Veuillez entrer votre adresse courriel",
                errorEmailMatch: "Les adresses courriel ne correspondent pas",
                errorPasswordRequired: "Veuillez entrer votre mot de passe",
                errorPasswordMatch: "Les mots de passe ne correspondent pas",
                errorTermsRequired: "Vous devez accepter les Conditions d'utilisation et la Politique de confidentialité",
                successAccountCreated: "Compte créé! Veuillez vérifier votre courriel."
            }
        };
        
        // Function to update UI text based on language
        function updateUILanguage(lang) {
            // Update all elements with a data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
            
            // Update href attributes for links
            document.querySelectorAll('[data-i18n-href]').forEach(element => {
                const key = element.getAttribute('data-i18n-href');
                if (translations[lang][key]) {
                    element.href = translations[lang][key];
                }
            });
        }
        
        // Global language state
        let currentLanguage = 'en';
        // Global variable to track verification check timer
        let verificationCheckTimer = null;
        
        // === ELEMENT REFERENCES ===
        // Get all elements
        const landingPage = document.getElementById('landing-page');
        const loginContainer = document.getElementById('login-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        
        // Landing page elements
        const frSwitchLanding = document.getElementById('fr-switch-landing');
        const enSwitchLanding = document.getElementById('en-switch-landing');
        
        // Login page elements
        const frSwitch = document.getElementById('fr-switch');
        const enSwitch = document.getElementById('en-switch');
        const frLogin = document.getElementById('fr-login');
        const enLogin = document.getElementById('en-login');
        
        // Registration elements
        const registrationBox = document.getElementById('registration-box');
        const registrationForm = document.getElementById('registration-form');
        const regPassword = document.getElementById('reg-password');
        const regPasswordConfirm = document.getElementById('reg-password-confirm');
        const regEmail = document.getElementById('reg-email');
        const regEmailConfirm = document.getElementById('reg-email-confirm');
        const termsCheckbox = document.getElementById('terms-checkbox');
        const regStrengthIndicator = document.getElementById('reg-strength-indicator');
        const regPasswordFeedback = document.getElementById('reg-password-feedback');
        const regError = document.getElementById('reg-error');
        const backToLoginBtn = document.getElementById('back-to-login-btn');
        const loadingSpinnerReg = document.getElementById('loading-spinner-reg');
        
        // Verification elements
        const enVerification = document.getElementById('en-verification');
        const frVerification = document.getElementById('fr-verification');
        const resendVerificationEn = document.getElementById('resend-verification-en');
        const resendVerificationFr = document.getElementById('resend-verification-fr');
        const backToLoginEn = document.getElementById('back-to-login-en');
        const backToLoginFr = document.getElementById('back-to-login-fr');
        const loadingSpinnerVerifyEn = document.getElementById('loading-spinner-verify-en');
        const loadingSpinnerVerifyFr = document.getElementById('loading-spinner-verify-fr');
        
        // Dashboard elements
        const frSwitchDashboard = document.getElementById('fr-switch-dashboard');
        const enSwitchDashboard = document.getElementById('en-switch-dashboard');
        const frDashboard = document.getElementById('fr-dashboard');
        const enDashboard = document.getElementById('en-dashboard');
        
        // Footer elements
        const footerEn = document.getElementById('footer-en');
        const footerFr = document.getElementById('footer-fr');
        
        // Form elements
        const loginFormEn = document.getElementById('login-form-en');
        const loginFormFr = document.getElementById('login-form-fr');
        const createAccountEn = document.getElementById('create-account-en');
        const createAccountFr = document.getElementById('create-account-fr');
        const forgotPasswordEn = document.getElementById('forgot-password-en');
        const forgotPasswordFr = document.getElementById('forgot-password-fr');
        const logoutEn = document.getElementById('logout-en');
        const logoutFr = document.getElementById('logout-fr');
        const loadingSpinnerEn = document.getElementById('loading-spinner-en');
        const loadingSpinnerFr = document.getElementById('loading-spinner-fr');
        
        // Password elements
        const passwordEn = document.getElementById('password-en');
        const passwordFr = document.getElementById('password-fr');
        const strengthIndicatorEn = document.getElementById('strength-indicator-en');
        const strengthIndicatorFr = document.getElementById('strength-indicator-fr');
        const passwordFeedbackEn = document.getElementById('password-feedback-en');
        const passwordFeedbackFr = document.getElementById('password-feedback-fr');
        
        // Error elements
        const errorEn = document.getElementById('error-en');
        const errorFr = document.getElementById('error-fr');
        
        // Email display elements
        const welcomeEmailEn = document.getElementById('welcome-email-en');
        const welcomeEmailFr = document.getElementById('welcome-email-fr');
        
        // === EVENT LISTENERS ===
        // Event Listeners - Landing Page
        frSwitchLanding.addEventListener('click', () => goToLogin('fr'));
        enSwitchLanding.addEventListener('click', () => goToLogin('en'));
        
        // Event Listeners - Login Page
        frSwitch.addEventListener('click', () => switchLanguage('fr'));
        enSwitch.addEventListener('click', () => switchLanguage('en'));
        
        // Event Listeners - Dashboard
        frSwitchDashboard.addEventListener('click', () => switchLanguage('fr'));
        enSwitchDashboard.addEventListener('click', () => switchLanguage('en'));
        
        // Event Listeners - Verification
        if (resendVerificationEn) {
            resendVerificationEn.addEventListener('click', () => resendVerification('en'));
        }
        if (resendVerificationFr) {
            resendVerificationFr.addEventListener('click', () => resendVerification('fr'));
        }
        if (backToLoginEn) {
            backToLoginEn.addEventListener('click', () => showLogin('en'));
        }
        if (backToLoginFr) {
            backToLoginFr.addEventListener('click', () => showLogin('fr'));
        }
        
        // Password Strength Event Listeners
        if (passwordEn) {
            passwordEn.addEventListener('input', (e) => updatePasswordStrength(e.target.value, 'en'));
        }
        if (passwordFr) {
            passwordFr.addEventListener('input', (e) => updatePasswordStrength(e.target.value, 'fr'));
        }
        if (regPassword) {
            regPassword.addEventListener('input', (e) => updateRegistrationPasswordStrength(e.target.value));
        }
        
        // Registration form events
        if (registrationForm) {
            registrationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleRegistration();
            });
        }
        
        if (backToLoginBtn) {
            backToLoginBtn.addEventListener('click', () => {
                showLogin(currentLanguage);
            });
        }
        
        // Create Account buttons
        if (createAccountEn) {
            createAccountEn.addEventListener('click', (e) => {
                e.preventDefault();
                showRegistration();
            });
        }
        if (createAccountFr) {
            createAccountFr.addEventListener('click', (e) => {
                e.preventDefault();
                showRegistration();
            });
        }
        
        // Form Event Listeners
        console.log('Setting up event listeners...');
        
        if (loginFormEn) {
            loginFormEn.addEventListener('submit', (e) => {
                e.preventDefault();
                console.log('English form submitted');
                handleLogin(e, 'en');
            });
        }
        
        if (loginFormFr) {
            loginFormFr.addEventListener('submit', (e) => {
                e.preventDefault();
                console.log('French form submitted');
                handleLogin(e, 'fr');
            });
        }
        
        if (forgotPasswordEn) {
            forgotPasswordEn.addEventListener('click', () => {
                handleForgotPassword('en');
            });
        }
        
        if (forgotPasswordFr) {
            forgotPasswordFr.addEventListener('click', () => {
                handleForgotPassword('fr');
            });
        }
        
        console.log('Event listeners set up complete');
        
        // === DISPLAY MANAGEMENT FUNCTIONS ===
        function hideAllLoginForms() {
            // Hide all boxes within login container
            frLogin.style.display = 'none';
            enLogin.style.display = 'none';
            frVerification.style.display = 'none';
            enVerification.style.display = 'none';
            registrationBox.style.display = 'none';
        }
        
        function goToLogin(lang) {
            landingPage.style.display = 'none';
            loginContainer.style.display = 'flex';
            dashboardContainer.style.display = 'none';
            
            // Hide all forms within the container first, then show the appropriate one
            hideAllLoginForms();
            
            // Show the correct language login form
            if (lang === 'en') {
                enLogin.style.display = 'block';
            } else {
                frLogin.style.display = 'block';
            }
            
            // Update current language
            currentLanguage = lang;
            updateLanguageIndicators();
        }
        
        function updateLanguageIndicators() {
            // Update language indicators based on current language
            if (currentLanguage === 'fr') {
                frSwitch.style.fontWeight = '700';
                enSwitch.style.fontWeight = '400';
                if (frSwitchDashboard && enSwitchDashboard) {
                    frSwitchDashboard.style.fontWeight = '700';
                    enSwitchDashboard.style.fontWeight = '400';
                }
                footerFr.style.display = 'block';
                footerEn.style.display = 'none';
                document.documentElement.lang = 'fr';
            } else {
                enSwitch.style.fontWeight = '700';
                frSwitch.style.fontWeight = '400';
                if (frSwitchDashboard && enSwitchDashboard) {
                    enSwitchDashboard.style.fontWeight = '700';
                    frSwitchDashboard.style.fontWeight = '400';
                }
                footerEn.style.display = 'block';
                footerFr.style.display = 'none';
                document.documentElement.lang = 'en';
            }
        }
        
        function switchLanguage(lang) {
            // Update language state
            currentLanguage = lang;
            
            // Update the registration form if it's visible
            if (registrationBox.style.display === 'block') {
                updateUILanguage(lang);
            }
            
            // Update language indicators
            updateLanguageIndicators();
            
            // Determine which screen to show based on current container
            if (dashboardContainer.style.display === 'flex') {
                // Dashboard is showing - update it
                if (lang === 'fr') {
                    frDashboard.style.display = 'block';
                    enDashboard.style.display = 'none';
                } else {
                    enDashboard.style.display = 'block';
                    frDashboard.style.display = 'none';
                }
            } else if (loginContainer.style.display === 'flex') {
                // If registration form is showing, just update the text
                if (registrationBox.style.display === 'block') {
                    return;
                }
                
                // Login container is showing - determine if login or verification should show
                const user = auth.currentUser;
                if (user && !user.emailVerified) {
                    showVerificationScreen(lang);
                } else {
                    showLogin(lang);
                }
            }
        }
        
        // Setup verification check
        function setupVerificationCheck() {
            // Clear any existing timers
            if (verificationCheckTimer) {
                clearInterval(verificationCheckTimer);
            }
            
            // Check every 3 seconds if the user has verified their email
            verificationCheckTimer = setInterval(() => {
                const user = auth.currentUser;
                if (user) {
                    // Force refresh the token to get updated verification status
                    user.getIdToken(true)
                        .then(() => {
                            // Reload user to get latest verification status
                            return user.reload();
                        })
                        .then(() => {
                            // Check if user is now verified
                            if (auth.currentUser.emailVerified) {
                                console.log('Email verified, redirecting to dashboard');
                                clearInterval(verificationCheckTimer);
                                showDashboard();
                            }
                        })
                        .catch(error => {
                            console.error('Error refreshing token:', error);
                        });
                } else {
                    // No user, clear the interval
                    clearInterval(verificationCheckTimer);
                }
            }, 3000);
        }
        
        function showVerificationScreen(lang) {
            // Make sure login container is visible
            landingPage.style.display = 'none';
            loginContainer.style.display = 'flex';
            dashboardContainer.style.display = 'none';
            
            // Hide all login forms and verification screens first
            hideAllLoginForms();
            
            // Show verification screen based on language
            if (lang === 'en') {
                enVerification.style.display = 'block';
            } else {
                frVerification.style.display = 'block';
            }
            
            // Start checking for verification status
            setupVerificationCheck();
        }
        
        function showLogin(lang) {
            // First check if the user is logged in and verified
            const user = auth.currentUser;
            if (user && user.emailVerified) {
                // User is verified - show dashboard instead of login
                console.log('User is already verified, showing dashboard instead of login');
                showDashboard();
                return;
            }
            
            // Otherwise proceed with showing the login form
            landingPage.style.display = 'none';
            loginContainer.style.display = 'flex';
            dashboardContainer.style.display = 'none';
            
            // Hide all verification screens and login forms first
            hideAllLoginForms();
            
            // Show login form based on language
            if (lang === 'en') {
                enLogin.style.display = 'block';
            } else {
                frLogin.style.display = 'block';
            }
        }
        
        function showDashboard() {
            // Clear any verification check timers
            if (verificationCheckTimer) {
                clearInterval(verificationCheckTimer);
                verificationCheckTimer = null;
            }
            
            landingPage.style.display = 'none';
            loginContainer.style.display = 'none';
            dashboardContainer.style.display = 'flex';
            
            // Update welcome message
            const user = auth.currentUser;
            if (user) {
                welcomeEmailEn.textContent = `Logged in as: ${user.email}`;
                welcomeEmailFr.textContent = `Connecté en tant que: ${user.email}`;
            }
            
            // Apply current language to dashboard
            if (currentLanguage === 'fr') {
                frDashboard.style.display = 'block';
                enDashboard.style.display = 'none';
            } else {
                enDashboard.style.display = 'block';
                frDashboard.style.display = 'none';
            }
            
            // Re-attach logout event listeners if they're missing
            if (logoutEn) {
                logoutEn.removeEventListener('click', handleLogout);
                logoutEn.addEventListener('click', handleLogout);
            }
            if (logoutFr) {
                logoutFr.removeEventListener('click', handleLogout);
                logoutFr.addEventListener('click', handleLogout);
            }
        }
        
        function showRegistration() {
            // Make sure login container is visible
            landingPage.style.display = 'none';
            loginContainer.style.display = 'flex';
            dashboardContainer.style.display = 'none';
            
            // Hide all forms
            hideAllLoginForms();
            
            // Show registration form and update text based on current language
            registrationBox.style.display = 'block';
            updateUILanguage(currentLanguage);
            
            // Clear any existing form data
            registrationForm.reset();
            regStrengthIndicator.style.width = '0%';
            regPasswordFeedback.textContent = '';
            regError.textContent = '';
        }
        
        // === AUTHENTICATION FUNCTIONS ===
        async function handleLogin(event, lang) {
            event.preventDefault();
            console.log('Login attempt:', lang);
            const email = document.getElementById(`email-${lang}`).value;
            const password = document.getElementById(`password-${lang}`).value;
            console.log('Email:', email, 'Password length:', password.length);
            const errorElement = document.getElementById(`error-${lang}`);
            const loadingSpinner = document.getElementById(`loading-spinner-${lang}`);
            
            // Custom validation
            if (!email) {
                errorElement.textContent = lang === 'en' ? 
                    'Please enter your email address' : 
                    'Veuillez entrer votre adresse courriel';
                return;
            }
            
            if (!password) {
                errorElement.textContent = lang === 'en' ? 
                    'Please enter your password' : 
                    'Veuillez entrer votre mot de passe';
                return;
            }
            
            try {
                // Show loading spinner
                loadingSpinner.style.display = 'block';
                errorElement.textContent = '';
                
                console.log('Attempting Firebase login...');
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('Login successful:', userCredential.user.email);
                // Success is handled by onAuthStateChanged
            } catch (error) {
                console.error('Login error:', error);
                handleAuthError(error, lang);
            } finally {
                // Hide loading spinner
                loadingSpinner.style.display = 'none';
            }
        }
        
        async function handleRegistration() {
            const email = regEmail.value;
            const emailConfirm = regEmailConfirm.value;
            const password = regPassword.value;
            const passwordConfirm = regPasswordConfirm.value;
            const termsAccepted = termsCheckbox.checked;
            
            // Reset error styling
            regError.style.color = 'var(--primary)';
            regError.textContent = '';
            
            // Validation
            if (!email) {
                regError.textContent = translations[currentLanguage].errorEmailRequired;
                return;
            }
            
            if (email !== emailConfirm) {
                regError.textContent = translations[currentLanguage].errorEmailMatch;
                return;
            }
            
            if (!password) {
                regError.textContent = translations[currentLanguage].errorPasswordRequired;
                return;
            }
            
            if (password !== passwordConfirm) {
                regError.textContent = translations[currentLanguage].errorPasswordMatch;
                return;
            }
            
            // Validate password strength
            const validation = validatePassword(password);
            if (!validation.valid) {
                regError.textContent = currentLanguage === 'en' ? 
                    'Password must be at least 8 characters with 1 number, 1 uppercase letter, and 1 special character' : 
                    'Le mot de passe doit comporter au moins 8 caractères avec 1 chiffre, 1 lettre majuscule et 1 caractère spécial';
                return;
            }
            
            // Check terms acceptance
            if (!termsAccepted) {
                regError.textContent = translations[currentLanguage].errorTermsRequired;
                return;
            }
            
            try {
                // Show loading spinner
                loadingSpinnerReg.style.display = 'block';
                regError.textContent = '';
                
                console.log('Attempting Firebase createUser...');
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                console.log('Account created:', userCredential.user.email);
                
                // Send verification email
                await sendEmailVerification(userCredential.user);
                console.log('Verification email sent');
                
                // Show verification message
                regError.style.color = 'var(--success)';
                regError.textContent = translations[currentLanguage].successAccountCreated;
                
                // Show verification screen after short delay
                setTimeout(() => {
                    showVerificationScreen(currentLanguage);
                }, 2000);
                
            } catch (error) {
                console.error('Registration error:', error);
                handleRegistrationError(error);
            } finally {
                // Hide loading spinner
                loadingSpinnerReg.style.display = 'none';
            }
        }
        
        function handleRegistrationError(error) {
            console.error('Registration error:', error.code, error.message);
            
            // Reset error styling
            regError.style.color = 'var(--primary)';
            
            switch(error.code) {
                case 'auth/email-already-in-use':
                    regError.textContent = currentLanguage === 'en' ? 
                        'Email is already in use. Try logging in instead.' : 
                        'Ce courriel est déjà utilisé. Essayez de vous connecter.';
                    break;
                case 'auth/invalid-email':
                    regError.textContent = currentLanguage === 'en' ? 
                        'Please enter a valid email address.' : 
                        'Veuillez entrer une adresse courriel valide.';
                    break;
                case 'auth/weak-password':
                    regError.textContent = currentLanguage === 'en' ? 
                        'Password is too weak. Please use a stronger password.' : 
                        'Le mot de passe est trop faible. Veuillez utiliser un mot de passe plus fort.';
                    break;
                case 'auth/network-request-failed':
                    regError.textContent = currentLanguage === 'en' ? 
                        'Network error. Please check your connection.' : 
                        'Erreur réseau. Veuillez vérifier votre connexion.';
                    break;
                default:
                    regError.textContent = currentLanguage === 'en' ? 
                        'An error occurred. Please try again.' : 
                        'Une erreur s\'est produite. Veuillez réessayer.';
            }
        }
        
        async function resendVerification(lang) {
            const loadingSpinner = document.getElementById(`loading-spinner-verify-${lang}`);
            
            try {
                // Show loading spinner
                loadingSpinner.style.display = 'block';
                
                const user = auth.currentUser;
                if (user) {
                    await sendEmailVerification(user);
                    alert(lang === 'en' ? 
                        'Verification email sent again!' : 
                        'Courriel de vérification envoyé à nouveau!');
                } else {
                    // User not logged in, show login form
                    showLogin(lang);
                }
            } catch (error) {
                console.error('Error sending verification email:', error);
                alert(lang === 'en' ? 
                    'Error sending verification email. Please try again.' : 
                    'Erreur lors de l\'envoi du courriel de vérification. Veuillez réessayer.');
            } finally {
                // Hide loading spinner
                loadingSpinner.style.display = 'none';
            }
        }
        
        async function handleForgotPassword(lang) {
            console.log('Forgot password:', lang);
            const email = document.getElementById(`email-${lang}`).value;
            const errorElement = document.getElementById(`error-${lang}`);
            const loadingSpinner = document.getElementById(`loading-spinner-${lang}`);
            
            if (!email) {
                console.log('Missing email for forgot password');
                errorElement.textContent = lang === 'en' ? 
                    'Please enter your email address' : 
                    'Veuillez entrer votre adresse courriel';
                return;
            }
            
            try {
                // Show loading spinner
                loadingSpinner.style.display = 'block';
                errorElement.textContent = '';
                
                console.log('Sending password reset email...');
                await sendPasswordResetEmail(auth, email);
                errorElement.style.color = 'var(--success)';
                errorElement.textContent = lang === 'en' ? 
                    'Password reset email sent!' : 
                    'Courriel de réinitialisation envoyé!';
                setTimeout(() => {
                    errorElement.textContent = '';
                    errorElement.style.color = 'var(--primary)';
                }, 3000);
            } catch (error) {
                console.error('Forgot password error:', error);
                handleAuthError(error, lang);
            } finally {
                // Hide loading spinner
                loadingSpinner.style.display = 'none';
            }
        }
        
        async function handleLogout() {
            try {
                await signOut(auth);
                // Redirect to landing page
                landingPage.style.display = 'flex';
                loginContainer.style.display = 'none';
                dashboardContainer.style.display = 'none';
                
                // Clear forms
                document.getElementById('email-en').value = '';
                document.getElementById('password-en').value = '';
                document.getElementById('email-fr').value = '';
                document.getElementById('password-fr').value = '';
                
                // Clear errors
                document.getElementById('error-en').textContent = '';
                document.getElementById('error-fr').textContent = '';
                
                // Reset password strength indicators
                updatePasswordStrength('', 'en');
                updatePasswordStrength('', 'fr');
                
                // Clear any verification check timers
                if (verificationCheckTimer) {
                    clearInterval(verificationCheckTimer);
                    verificationCheckTimer = null;
                }
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }
        
        // === PASSWORD MANAGEMENT ===
        // Password validation function
        function validatePassword(password) {
            // At least 8 characters, 1 number, 1 uppercase, 1 special char
            const minLength = password.length >= 8;
            const hasNumber = /\d/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            
            return {
                valid: minLength && hasNumber && hasUpper && hasSpecial,
                minLength,
                hasNumber,
                hasUpper,
                hasSpecial
            };
        }
        
        // Update password strength indicator for login forms
        function updatePasswordStrength(password, lang) {
            const indicator = document.getElementById(`strength-indicator-${lang}`);
            const feedback = document.getElementById(`password-feedback-${lang}`);
            
            if (!password) {
                indicator.style.width = '0%';
                feedback.textContent = '';
                return;
            }
            
            const validation = validatePassword(password);
            
            // Calculate strength percentage
            let strength = 0;
            if (validation.minLength) strength += 25;
            if (validation.hasNumber) strength += 25;
            if (validation.hasUpper) strength += 25;
            if (validation.hasSpecial) strength += 25;
            
            // Update indicator
            indicator.style.width = `${strength}%`;
            
            // Set color based on strength
            if (strength < 50) {
                indicator.style.backgroundColor = '#FF4136'; // Weak - Red
            } else if (strength < 100) {
                indicator.style.backgroundColor = '#FF851B'; // Medium - Orange
            } else {
                indicator.style.backgroundColor = '#2ECC40'; // Strong - Green
            }
            
            // Update feedback text
            if (lang === 'en') {
                if (!validation.valid) {
                    let feedbackText = 'Password should have:';
                    if (!validation.minLength) feedbackText += ' 8+ characters.';
                    if (!validation.hasNumber) feedbackText += ' At least 1 number.';
                    if (!validation.hasUpper) feedbackText += ' At least 1 uppercase letter.';
                    if (!validation.hasSpecial) feedbackText += ' At least 1 special character.';
                    feedback.textContent = feedbackText;
                } else {
                    feedback.textContent = 'Strong password';
                }
            } else {
                if (!validation.valid) {
                    let feedbackText = 'Le mot de passe doit avoir:';
                    if (!validation.minLength) feedbackText += ' 8+ caractères.';
                    if (!validation.hasNumber) feedbackText += ' Au moins 1 chiffre.';
                    if (!validation.hasUpper) feedbackText += ' Au moins 1 majuscule.';
                    if (!validation.hasSpecial) feedbackText += ' Au moins 1 caractère spécial.';
                    feedback.textContent = feedbackText;
                } else {
                    feedback.textContent = 'Mot de passe fort';
                }
            }
        }
        
        // Update password strength indicator for registration form
        function updateRegistrationPasswordStrength(password) {
            if (!password) {
                regStrengthIndicator.style.width = '0%';
                regPasswordFeedback.textContent = '';
                return;
            }
            
            const validation = validatePassword(password);
            
            // Calculate strength percentage
            let strength = 0;
            if (validation.minLength) strength += 25;
            if (validation.hasNumber) strength += 25;
            if (validation.hasUpper) strength += 25;
            if (validation.hasSpecial) strength += 25;
            
            // Update indicator
            regStrengthIndicator.style.width = `${strength}%`;
            
            // Set color based on strength
            if (strength < 50) {
                regStrengthIndicator.style.backgroundColor = '#FF4136'; // Weak - Red
            } else if (strength < 100) {
                regStrengthIndicator.style.backgroundColor = '#FF851B'; // Medium - Orange
            } else {
                regStrengthIndicator.style.backgroundColor = '#2ECC40'; // Strong - Green
            }
            
            // Update feedback text using translations
            if (!validation.valid) {
                let feedbackText = translations[currentLanguage].passwordRequirements;
                if (!validation.minLength) feedbackText += ' ' + translations[currentLanguage].passwordLength;
                if (!validation.hasNumber) feedbackText += ' ' + translations[currentLanguage].passwordNumber;
                if (!validation.hasUpper) feedbackText += ' ' + translations[currentLanguage].passwordUpper;
                if (!validation.hasSpecial) feedbackText += ' ' + translations[currentLanguage].passwordSpecial;
                regPasswordFeedback.textContent = feedbackText;
            } else {
                regPasswordFeedback.textContent = translations[currentLanguage].passwordStrength;
            }
        }
        
        // === ERROR HANDLING ===
        // Handle Firebase Auth errors with user-friendly messages
        function handleAuthError(error, lang) {
            console.error('Auth error:', error.code, error.message);
            const errorElement = document.getElementById(`error-${lang}`);
            
            // Reset error styling
            errorElement.style.color = 'var(--primary)';
            
            switch(error.code) {
                case 'auth/email-already-in-use':
                    errorElement.textContent = lang === 'en' ? 
                        'Email is already in use. Try logging in instead.' : 
                        'Ce courriel est déjà utilisé. Essayez de vous connecter.';
                    break;
                case 'auth/invalid-email':
                    errorElement.textContent = lang === 'en' ? 
                        'Please enter a valid email address.' : 
                        'Veuillez entrer une adresse courriel valide.';
                    break;
                case 'auth/user-disabled':
                    errorElement.textContent = lang === 'en' ? 
                        'This account has been disabled.' : 
                        'Ce compte a été désactivé.';
                    break;
                case 'auth/user-not-found':
                    errorElement.textContent = lang === 'en' ? 
                        'No account found with this email.' : 
                        'Aucun compte trouvé avec ce courriel.';
                    break;
                case 'auth/wrong-password':
                    errorElement.textContent = lang === 'en' ? 
                        'Incorrect password.' : 
                        'Mot de passe incorrect.';
                    break;
                case 'auth/weak-password':
                    errorElement.textContent = lang === 'en' ? 
                        'Password is too weak. Please use a stronger password.' : 
                        'Le mot de passe est trop faible. Veuillez utiliser un mot de passe plus fort.';
                    break;
                case 'auth/network-request-failed':
                    errorElement.textContent = lang === 'en' ? 
                        'Network error. Please check your connection.' : 
                        'Erreur réseau. Veuillez vérifier votre connexion.';
                    break;
                case 'auth/too-many-requests':
                    errorElement.textContent = lang === 'en' ? 
                        'Too many attempts. Please try again later.' : 
                        'Trop de tentatives. Veuillez réessayer plus tard.';
                    break;
                default:
                    errorElement.textContent = lang === 'en' ? 
                        'An error occurred. Please try again.' : 
                        'Une erreur s\'est produite. Veuillez réessayer.';
            }
        }
        
        // === AUTH STATE MANAGEMENT ===
        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user ? user.email : 'signed out');
            if (user) {
                // User is signed in
                console.log('User signed in, verified:', user.emailVerified);
                
                // Check if email is verified
                if (!user.emailVerified) {
                    // Show verification needed message
                    landingPage.style.display = 'none';
                    loginContainer.style.display = 'flex';
                    dashboardContainer.style.display = 'none';
                    
                    // Show verification screen
                    showVerificationScreen(currentLanguage);
                    
                    return;
                }
                
                // User is verified - show dashboard
                showDashboard();
            } else {
                // User is signed out
                console.log('User signed out, showing landing page');
                dashboardContainer.style.display = 'none';
                landingPage.style.display = 'flex';
                loginContainer.style.display = 'none';
                
                // Clear any verification check timers
                if (verificationCheckTimer) {
                    clearInterval(verificationCheckTimer);
                    verificationCheckTimer = null;
                }
            }
        });
    </script>
</body>
</html>